"use strict";
var express = require('express');
var Product = require('../model/product');
var ProductsModel = require('../model/products');
var Products = (function () {
    function Products() {
        this.productList = new ProductsModel.Products([
            new Product.Product(1, 'ABC', 1),
            new Product.Product(2, 'DEF', 12),
            new Product.Product(3, 'GHI')
        ]);
    }
    Products.routes = function () {
        var router = express.Router();
        var productsRoute = new Products();
        router.get('/products/', productsRoute.index.bind(productsRoute));
        router.post('/products/', productsRoute.create.bind(productsRoute));
        router.put('/products/:product_id', productsRoute.update.bind(productsRoute));
        router.delete('/products/:product_id', productsRoute.delete.bind(productsRoute));
        router.get('/products/:product', productsRoute.find.bind(productsRoute));
        router.post('/products/delete/:product_id', productsRoute.delete.bind(productsRoute));
        router.post('/products/update/:product_id', productsRoute.update.bind(productsRoute));
        return router;
    };
    Products.prototype.index = function (request, response) {
        response.json(this.productList.list());
    };
    Products.prototype.create = function (request, response) {
        var productName = request.body.product_name;
        var productQuantity = parseInt(request.body.quantity) || 0;
        if (!productName) {
            response.status(500).send('Product name not found');
            return;
        }
        response.json(this.productList.add(productName, productQuantity));
    };
    Products.prototype.update = function (request, response) {
        var productId = parseInt(request.params.product_id);
        var product = this.productList.fetch(productId);
        var productName = request.body.product_name;
        var productQuantity = request.body.quantity;
        if (!product) {
            response.status(404).send('Product not found');
            return;
        }
        if (productName !== undefined) {
            product.setName(productName);
        }
        if (productQuantity !== undefined) {
            product.updateQuantity(productQuantity);
        }
        response.json(product);
    };
    Products.prototype.delete = function (request, response) {
        var productId = parseInt(request.params.product_id);
        var wasDeleted = this.productList.delete(productId);
        if (!wasDeleted) {
            response.status(404).send('Product not found');
            return;
        }
        else {
            response.json({ success: true });
        }
    };
    Products.prototype.find = function (request, response) {
        var productQuery = request.params.product;
        var product = this.productList.find(productQuery);
        if (!product) {
            response.status(404).send('Product not found');
            return;
        }
        response.json(product);
    };
    return Products;
}());
exports.Products = Products;

//# sourceMappingURL=data:application/json;charset=utf8;base64,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Q0FBQztZQUNDLFFBQVEsQ0FBQyxJQUFJLENBQUMsRUFBQyxPQUFPLEVBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQztRQUNqQyxDQUFDO0lBRUwsQ0FBQztJQUNNLHVCQUFJLEdBQVgsVUFBWSxPQUF3QixFQUFFLFFBQTBCO1FBQzVELElBQUksWUFBWSxHQUFXLE9BQU8sQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDO1FBQ2xELElBQUksT0FBTyxHQUFvQixJQUFJLENBQUMsV0FBVyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUVuRSxFQUFFLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUM7WUFDWCxRQUFRLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO1lBQy9DLE1BQU0sQ0FBQztRQUNYLENBQUM7UUFDRCxRQUFRLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBRTNCLENBQUM7SUFDTCxlQUFDO0FBQUQsQ0FwRkEsQUFvRkMsSUFBQTtBQXBGWSxnQkFBUSxXQW9GcEIsQ0FBQSIsImZpbGUiOiJyb3V0ZXMvcHJvZHVjdHMuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBleHByZXNzIGZyb20gJ2V4cHJlc3MnO1xyXG5pbXBvcnQgKiBhcyBQcm9kdWN0IGZyb20gJy4uL21vZGVsL3Byb2R1Y3QnO1xyXG5pbXBvcnQgKiBhcyBQcm9kdWN0c01vZGVsIGZyb20gJy4uL21vZGVsL3Byb2R1Y3RzJztcclxuXHJcbmV4cG9ydCBjbGFzcyBQcm9kdWN0cyB7XHJcbiAgICBwcml2YXRlIHByb2R1Y3RMaXN0OiBQcm9kdWN0c01vZGVsLlByb2R1Y3RzO1xyXG4gICAgcHVibGljIHN0YXRpYyByb3V0ZXMoKTogZXhwcmVzcy5Sb3V0ZXIge1xyXG4gICAgICAgIGxldCByb3V0ZXI6IGV4cHJlc3MuUm91dGVyID0gZXhwcmVzcy5Sb3V0ZXIoKTtcclxuICAgICAgICBsZXQgcHJvZHVjdHNSb3V0ZTogUHJvZHVjdHMgPSBuZXcgUHJvZHVjdHMoKTtcclxuICAgICAgICByb3V0ZXIuZ2V0KCcvcHJvZHVjdHMvJywgcHJvZHVjdHNSb3V0ZS5pbmRleC5iaW5kKHByb2R1Y3RzUm91dGUpKTtcclxuICAgICAgICByb3V0ZXIucG9zdCgnL3Byb2R1Y3RzLycsIHByb2R1Y3RzUm91dGUuY3JlYXRlLmJpbmQocHJvZHVjdHNSb3V0ZSkpO1xyXG4gICAgICAgIHJvdXRlci5wdXQoJy9wcm9kdWN0cy86cHJvZHVjdF9pZCcsIHByb2R1Y3RzUm91dGUudXBkYXRlLmJpbmQocHJvZHVjdHNSb3V0ZSkpO1xyXG4gICAgICAgIHJvdXRlci5kZWxldGUoJy9wcm9kdWN0cy86cHJvZHVjdF9pZCcsIHByb2R1Y3RzUm91dGUuZGVsZXRlLmJpbmQocHJvZHVjdHNSb3V0ZSkpO1xyXG4gICAgICAgIHJvdXRlci5nZXQoJy9wcm9kdWN0cy86cHJvZHVjdCcsIHByb2R1Y3RzUm91dGUuZmluZC5iaW5kKHByb2R1Y3RzUm91dGUpKTtcclxuICAgICAgICByb3V0ZXIucG9zdCgnL3Byb2R1Y3RzL2RlbGV0ZS86cHJvZHVjdF9pZCcsIHByb2R1Y3RzUm91dGUuZGVsZXRlLmJpbmQocHJvZHVjdHNSb3V0ZSkpO1xyXG4gICAgICAgIHJvdXRlci5wb3N0KCcvcHJvZHVjdHMvdXBkYXRlLzpwcm9kdWN0X2lkJywgcHJvZHVjdHNSb3V0ZS51cGRhdGUuYmluZChwcm9kdWN0c1JvdXRlKSk7XHJcbiAgICAgICAgcmV0dXJuIHJvdXRlcjtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICB0aGlzLnByb2R1Y3RMaXN0ID0gbmV3IFByb2R1Y3RzTW9kZWwuUHJvZHVjdHMoW1xyXG4gICAgICAgICAgICBuZXcgUHJvZHVjdC5Qcm9kdWN0KDEsICdBQkMnLCAxKSxcclxuICAgICAgICAgICAgbmV3IFByb2R1Y3QuUHJvZHVjdCgyLCAnREVGJywgMTIpLFxyXG4gICAgICAgICAgICBuZXcgUHJvZHVjdC5Qcm9kdWN0KDMsICdHSEknKVxyXG4gICAgICAgIF0pXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGluZGV4KHJlcXVlc3Q6IGV4cHJlc3MuUmVxdWVzdCwgcmVzcG9uc2U6IGV4cHJlc3MuUmVzcG9uc2UpIHtcclxuICAgICAgICByZXNwb25zZS5qc29uKHRoaXMucHJvZHVjdExpc3QubGlzdCgpKTtcclxuICAgIH1cclxuICAgIHB1YmxpYyBjcmVhdGUocmVxdWVzdDogZXhwcmVzcy5SZXF1ZXN0LCByZXNwb25zZTogZXhwcmVzcy5SZXNwb25zZSkge1xyXG4gICAgICAgIGxldCBwcm9kdWN0TmFtZTogc3RyaW5nID0gcmVxdWVzdC5ib2R5LnByb2R1Y3RfbmFtZTtcclxuICAgICAgICBsZXQgcHJvZHVjdFF1YW50aXR5OiBudW1iZXIgPSBwYXJzZUludChyZXF1ZXN0LmJvZHkucXVhbnRpdHkpIHx8IDA7XHJcbiAgICAgICAgaWYgKCFwcm9kdWN0TmFtZSkge1xyXG4gICAgICAgICAgICByZXNwb25zZS5zdGF0dXMoNTAwKS5zZW5kKCdQcm9kdWN0IG5hbWUgbm90IGZvdW5kJyk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmVzcG9uc2UuanNvbih0aGlzLnByb2R1Y3RMaXN0LmFkZChwcm9kdWN0TmFtZSwgcHJvZHVjdFF1YW50aXR5KSk7XHJcbiAgICB9XHJcbiAgICBwdWJsaWMgdXBkYXRlKHJlcXVlc3Q6IGV4cHJlc3MuUmVxdWVzdCwgcmVzcG9uc2U6IGV4cHJlc3MuUmVzcG9uc2UpXHJcbiAgICB7XHJcbiAgICAgICAgbGV0IHByb2R1Y3RJZDogbnVtYmVyID0gcGFyc2VJbnQocmVxdWVzdC5wYXJhbXMucHJvZHVjdF9pZCk7XHJcbiAgICAgICAgbGV0IHByb2R1Y3Q6IFByb2R1Y3QuUHJvZHVjdCA9IHRoaXMucHJvZHVjdExpc3QuZmV0Y2gocHJvZHVjdElkKTtcclxuICAgICAgICBsZXQgcHJvZHVjdE5hbWU6IHN0cmluZyA9IHJlcXVlc3QuYm9keS5wcm9kdWN0X25hbWU7XHJcbiAgICAgICAgbGV0IHByb2R1Y3RRdWFudGl0eTogbnVtYmVyID0gcmVxdWVzdC5ib2R5LnF1YW50aXR5O1xyXG5cclxuICAgICAgICBpZiAoIXByb2R1Y3QpIHtcclxuICAgICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzKDQwNCkuc2VuZCgnUHJvZHVjdCBub3QgZm91bmQnKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYocHJvZHVjdE5hbWUgIT09IHVuZGVmaW5lZClcclxuICAgICAgICB7XHJcbiAgICAgICAgICBwcm9kdWN0LnNldE5hbWUocHJvZHVjdE5hbWUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYocHJvZHVjdFF1YW50aXR5ICE9PSB1bmRlZmluZWQpXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgcHJvZHVjdC51cGRhdGVRdWFudGl0eShwcm9kdWN0UXVhbnRpdHkpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmVzcG9uc2UuanNvbihwcm9kdWN0KTtcclxuICAgIH1cclxuICAgIHB1YmxpYyBkZWxldGUocmVxdWVzdDogZXhwcmVzcy5SZXF1ZXN0LCByZXNwb25zZTogZXhwcmVzcy5SZXNwb25zZSkge1xyXG4gICAgICAgIGxldCBwcm9kdWN0SWQ6IG51bWJlciA9IHBhcnNlSW50KHJlcXVlc3QucGFyYW1zLnByb2R1Y3RfaWQpO1xyXG4gICAgICAgIGxldCB3YXNEZWxldGVkOiBCb29sZWFuID0gdGhpcy5wcm9kdWN0TGlzdC5kZWxldGUocHJvZHVjdElkKTtcclxuXHJcbiAgICAgICAgaWYgKCF3YXNEZWxldGVkKSB7XHJcbiAgICAgICAgICAgIHJlc3BvbnNlLnN0YXR1cyg0MDQpLnNlbmQoJ1Byb2R1Y3Qgbm90IGZvdW5kJyk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZVxyXG4gICAgICAgIHtcclxuICAgICAgICAgIHJlc3BvbnNlLmpzb24oe3N1Y2Nlc3M6IHRydWV9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG4gICAgcHVibGljIGZpbmQocmVxdWVzdDogZXhwcmVzcy5SZXF1ZXN0LCByZXNwb25zZTogZXhwcmVzcy5SZXNwb25zZSkge1xyXG4gICAgICAgIGxldCBwcm9kdWN0UXVlcnk6IHN0cmluZyA9IHJlcXVlc3QucGFyYW1zLnByb2R1Y3Q7XHJcbiAgICAgICAgbGV0IHByb2R1Y3Q6IFByb2R1Y3QuUHJvZHVjdCA9IHRoaXMucHJvZHVjdExpc3QuZmluZChwcm9kdWN0UXVlcnkpO1xyXG5cclxuICAgICAgICBpZiAoIXByb2R1Y3QpIHtcclxuICAgICAgICAgICAgcmVzcG9uc2Uuc3RhdHVzKDQwNCkuc2VuZCgnUHJvZHVjdCBub3QgZm91bmQnKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXNwb25zZS5qc29uKHByb2R1Y3QpO1xyXG5cclxuICAgIH1cclxufVxyXG4iXX0=
